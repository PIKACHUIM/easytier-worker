# æ›´æ–°æ—¥å¿—

## [1.0.2] - 2025-01-04

### ğŸ” å®‰å…¨æ€§å¢å¼º

#### èŠ‚ç‚¹ä¸ŠæŠ¥TokenéªŒè¯æœºåˆ¶
- âœ¨ **æ–°å¢**: æ¯ä¸ªèŠ‚ç‚¹ç‹¬ç«‹çš„ä¸ŠæŠ¥éªŒè¯Token
- ğŸ”„ **å˜æ›´**: ä¸ŠæŠ¥APIä»ä½¿ç”¨node_idæ”¹ä¸ºä½¿ç”¨node_name + email + token
- âœ¨ **æ–°å¢**: Tokenç®¡ç†åŠŸèƒ½ï¼ˆæŸ¥çœ‹ã€å¤åˆ¶ã€é‡æ–°ç”Ÿæˆï¼‰
- âœ¨ **æ–°å¢**: æ•°æ®åº“å­—æ®µ `report_token`

#### APIå˜æ›´
- ğŸ”„ **å˜æ›´**: `POST /api/report` - è¯·æ±‚å‚æ•°ä»node_idæ”¹ä¸ºnode_name + email + token
- âœ¨ **æ–°å¢**: `POST /api/nodes/{id}/regenerate-token` - é‡æ–°ç”ŸæˆèŠ‚ç‚¹Token

#### å‰ç«¯åŠŸèƒ½
- âœ¨ **æ–°å¢**: èŠ‚ç‚¹å¡ç‰‡æ˜¾ç¤ºä¸ŠæŠ¥Token
- âœ¨ **æ–°å¢**: ä¸€é”®å¤åˆ¶TokenåŠŸèƒ½
- âœ¨ **æ–°å¢**: é‡æ–°ç”ŸæˆTokenæŒ‰é’®

#### æ–‡æ¡£å’Œç¤ºä¾‹
- ğŸ“ **æ›´æ–°**: APIæ–‡æ¡£ï¼Œè¯´æ˜æ–°çš„ä¸ŠæŠ¥æ–¹å¼
- âœ¨ **æ–°å¢**: `examples/node_report_v2.py` - æ–°ç‰ˆä¸ŠæŠ¥è„šæœ¬
- âœ¨ **æ–°å¢**: `migrations/add_report_token.sql` - æ•°æ®åº“è¿ç§»è„šæœ¬

#### âš ï¸ ç ´åæ€§å˜æ›´
- æ—§ç‰ˆä¸ŠæŠ¥APIï¼ˆä½¿ç”¨node_idï¼‰å·²æ ‡è®°ä¸ºåºŸå¼ƒï¼Œå°†åœ¨v1.1.0ä¸­ç§»é™¤

#### å‡çº§æŒ‡å—
è¯¦è§ [UPDATE_v1.0.2.md](./UPDATE_v1.0.2.md)

---

## [1.0.1] - 2025-01-04

### ğŸ‰ é‡å¤§æ›´æ–°

#### æ–°å¢åŠŸèƒ½

**ç³»ç»Ÿåˆå§‹åŒ–**
- âœ¨ æ·»åŠ ç³»ç»Ÿåˆå§‹åŒ–é¡µé¢ (`/initialize`)
- âœ¨ ä½¿ç”¨ JWT å¯†é’¥éªŒè¯åˆå§‹åŒ–è¯·æ±‚ï¼Œç¡®ä¿å®‰å…¨æ€§
- âœ¨ æ”¯æŒé€šè¿‡ Web ç•Œé¢åˆ›å»ºè¶…çº§ç®¡ç†å‘˜è´¦æˆ·
- âœ¨ ç³»ç»Ÿåˆå§‹åŒ–çŠ¶æ€æ£€æŸ¥ï¼Œé˜²æ­¢é‡å¤åˆå§‹åŒ–

**æƒé™ç³»ç»Ÿå‡çº§**
- âœ¨ ä¸‰çº§æƒé™ç³»ç»Ÿï¼šè¶…çº§ç®¡ç†å‘˜ / æ™®é€šç®¡ç†å‘˜ / æ™®é€šç”¨æˆ·
- âœ¨ è¶…çº§ç®¡ç†å‘˜ï¼šé€šè¿‡åˆå§‹åŒ–åˆ›å»ºï¼Œæ‹¥æœ‰æ‰€æœ‰æƒé™ï¼Œæ— æ³•è¢«åˆ é™¤æˆ–é™æƒ
- âœ¨ æ™®é€šç®¡ç†å‘˜ï¼šå¯æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹å’Œä¿®æ”¹ç³»ç»Ÿè®¾ç½®ï¼Œä½†ä¸èƒ½ç®¡ç†ç”¨æˆ·
- âœ¨ æ™®é€šç”¨æˆ·ï¼šåªèƒ½ç®¡ç†è‡ªå·±çš„èŠ‚ç‚¹

**ç³»ç»Ÿè®¾ç½®ç®¡ç†**
- âœ¨ æ·»åŠ ç³»ç»Ÿè®¾ç½®é¡µé¢ (`/settings`)
- âœ¨ Resend é‚®ä»¶æœåŠ¡é…ç½®ï¼ˆAPI å¯†é’¥ã€å‘ä»¶äººé‚®ç®±ã€å‘ä»¶åŸŸåï¼‰
- âœ¨ ç½‘ç«™é…ç½®ï¼ˆç½‘ç«™åç§°ã€ç½‘ç«™ URLï¼‰
- âœ¨ æ‰€æœ‰é…ç½®å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œæ”¯æŒåŠ¨æ€ä¿®æ”¹

**ç”¨æˆ·ç®¡ç†**
- âœ¨ ç”¨æˆ·åˆ—è¡¨æŸ¥çœ‹ï¼ˆç®¡ç†å‘˜æƒé™ï¼‰
- âœ¨ æˆäºˆ/æ’¤é”€ç®¡ç†å‘˜æƒé™ï¼ˆè¶…çº§ç®¡ç†å‘˜æƒé™ï¼‰
- âœ¨ åˆ é™¤ç”¨æˆ·åŠå…¶æ‰€æœ‰èŠ‚ç‚¹ï¼ˆè¶…çº§ç®¡ç†å‘˜æƒé™ï¼‰
- âœ¨ ç”¨æˆ·ä¿¡æ¯å±•ç¤ºï¼ˆé‚®ç®±ã€æƒé™ã€éªŒè¯çŠ¶æ€ã€æ³¨å†Œæ—¶é—´ï¼‰

**é‚®ä»¶æœåŠ¡ä¼˜åŒ–**
- âœ¨ Resend é…ç½®ä»æ•°æ®åº“è¯»å–ï¼Œæ”¯æŒåŠ¨æ€ä¿®æ”¹
- âœ¨ ä¼˜åŒ–éªŒè¯é‚®ä»¶æ¨¡æ¿
- âœ¨ é‚®ä»¶å‘é€å¤±è´¥ä¸å½±å“æ³¨å†Œæµç¨‹

#### æ•°æ®åº“å˜æ›´

**æ–°å¢è¡¨**
- `system_settings`: ç³»ç»Ÿè®¾ç½®è¡¨ï¼Œå­˜å‚¨æ‰€æœ‰ç³»ç»Ÿé…ç½®

**users è¡¨æ›´æ–°**
- æ–°å¢ `is_super_admin` å­—æ®µï¼šæ ‡è®°è¶…çº§ç®¡ç†å‘˜
- ç§»é™¤é»˜è®¤ç®¡ç†å‘˜æ’å…¥è¯­å¥ï¼ˆæ”¹ä¸ºé€šè¿‡åˆå§‹åŒ–é¡µé¢åˆ›å»ºï¼‰

**é»˜è®¤ç³»ç»Ÿè®¾ç½®**
- `resend_api_key`: Resend API å¯†é’¥
- `resend_from_email`: å‘ä»¶äººé‚®ç®±
- `resend_from_domain`: å‘ä»¶åŸŸå
- `system_initialized`: ç³»ç»Ÿåˆå§‹åŒ–çŠ¶æ€
- `site_name`: ç½‘ç«™åç§°
- `site_url`: ç½‘ç«™ URL

#### API æ›´æ–°

**æ–°å¢ API**
- `GET /api/system/check-init`: æ£€æŸ¥ç³»ç»Ÿåˆå§‹åŒ–çŠ¶æ€
- `POST /api/system/initialize`: åˆå§‹åŒ–ç³»ç»Ÿ
- `GET /api/system/settings`: è·å–ç³»ç»Ÿè®¾ç½®ï¼ˆç®¡ç†å‘˜ï¼‰
- `PUT /api/system/settings`: æ›´æ–°ç³»ç»Ÿè®¾ç½®ï¼ˆç®¡ç†å‘˜ï¼‰
- `GET /api/system/users`: è·å–ç”¨æˆ·åˆ—è¡¨ï¼ˆç®¡ç†å‘˜ï¼‰
- `PUT /api/system/users/:email/admin`: è®¾ç½®ç”¨æˆ·ç®¡ç†å‘˜æƒé™ï¼ˆè¶…çº§ç®¡ç†å‘˜ï¼‰
- `DELETE /api/system/users/:email`: åˆ é™¤ç”¨æˆ·ï¼ˆè¶…çº§ç®¡ç†å‘˜ï¼‰

**API ä¼˜åŒ–**
- ç”¨æˆ·æ³¨å†Œå‰æ£€æŸ¥ç³»ç»Ÿåˆå§‹åŒ–çŠ¶æ€
- ç™»å½•è¿”å›ä¿¡æ¯å¢åŠ  `is_super_admin` å­—æ®µ
- JWT payload å¢åŠ  `is_super_admin` å­—æ®µ

#### å‰ç«¯æ›´æ–°

**æ–°å¢é¡µé¢**
- åˆå§‹åŒ–é¡µé¢ (`/initialize`)
- ç³»ç»Ÿè®¾ç½®é¡µé¢ (`/settings`)

**æ–°å¢è„šæœ¬**
- `src/client/initialize.ts`: åˆå§‹åŒ–é¡µé¢è„šæœ¬
- `src/client/settings.ts`: ç³»ç»Ÿè®¾ç½®é¡µé¢è„šæœ¬

**æ ·å¼æ›´æ–°**
- æ·»åŠ æ¶ˆæ¯æç¤ºæ ·å¼ï¼ˆæˆåŠŸ/é”™è¯¯ï¼‰
- æ·»åŠ ç”¨æˆ·ç®¡ç†è¡¨æ ¼æ ·å¼
- æ·»åŠ ç³»ç»Ÿè®¾ç½®è¡¨å•æ ·å¼
- ä¼˜åŒ–å“åº”å¼å¸ƒå±€

#### æ–‡æ¡£æ›´æ–°

**æ–°å¢æ–‡æ¡£**
- `INITIALIZATION.md`: ç³»ç»Ÿåˆå§‹åŒ–å’Œç®¡ç†æŒ‡å—
- `QUICKSTART.md`: å¿«é€Ÿå¼€å§‹æŒ‡å—

**æ›´æ–°æ–‡æ¡£**
- `README.md`: æ›´æ–°åŠŸèƒ½ç‰¹æ€§ã€å¿«é€Ÿå¼€å§‹ã€æƒé™ç³»ç»Ÿè¯´æ˜
- `API.md`: æ·»åŠ ç³»ç»Ÿç®¡ç† API æ–‡æ¡£

#### å®‰å…¨æ€§æå‡

- âœ… JWT å¯†é’¥éªŒè¯åˆå§‹åŒ–è¯·æ±‚
- âœ… è¶…çº§ç®¡ç†å‘˜æ— æ³•è¢«åˆ é™¤æˆ–é™æƒ
- âœ… æ•æ„Ÿé…ç½®å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œæ”¯æŒåŠ¨æ€ä¿®æ”¹
- âœ… æƒé™åˆ†çº§ç®¡ç†ï¼Œæœ€å°æƒé™åŸåˆ™
- âœ… ç³»ç»Ÿåˆå§‹åŒ–åªèƒ½æ‰§è¡Œä¸€æ¬¡

### ğŸ”§ æ”¹è¿›

- ä¼˜åŒ–ç”¨æˆ·æ³¨å†Œæµç¨‹ï¼Œå¢åŠ ç³»ç»Ÿåˆå§‹åŒ–æ£€æŸ¥
- ä¼˜åŒ–é‚®ä»¶å‘é€é€»è¾‘ï¼Œä»æ•°æ®åº“è¯»å–é…ç½®
- ä¼˜åŒ–é”™è¯¯å¤„ç†å’Œç”¨æˆ·æç¤º
- æ”¹è¿›ä»£ç æ³¨é‡Šå’Œæ–‡æ¡£

### ğŸ› ä¿®å¤

- ä¿®å¤é»˜è®¤ç®¡ç†å‘˜å¯†ç å“ˆå¸Œå€¼é”™è¯¯
- ä¿®å¤ç±»å‹å®šä¹‰é—®é¢˜

### âš ï¸ ç ´åæ€§å˜æ›´

**æ•°æ®åº“ç»“æ„å˜æ›´**
- éœ€è¦é‡æ–°æ‰§è¡Œ `schema.sql` åˆå§‹åŒ–æ•°æ®åº“
- æ—§æ•°æ®åº“éœ€è¦æ‰‹åŠ¨è¿ç§»

**ç¯å¢ƒå˜é‡å˜æ›´**
- `RESEND_API_KEY` å˜ä¸ºå¯é€‰ï¼Œå¯åœ¨ç³»ç»Ÿè®¾ç½®ä¸­é…ç½®

**åˆå§‹åŒ–æµç¨‹å˜æ›´**
- ä¸å†é€šè¿‡ SQL æ’å…¥é»˜è®¤ç®¡ç†å‘˜
- å¿…é¡»é€šè¿‡ `/initialize` é¡µé¢åˆ›å»ºè¶…çº§ç®¡ç†å‘˜

### ğŸ“ è¿ç§»æŒ‡å—

å¦‚æœæ‚¨å·²ç»éƒ¨ç½²äº†æ—§ç‰ˆæœ¬ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤è¿ç§»ï¼š

1. **å¤‡ä»½æ•°æ®**
   ```bash
   npx wrangler d1 export easytier-db > backup.sql
   ```

2. **æ›´æ–°ä»£ç **
   ```bash
   git pull
   npm install
   ```

3. **æ›´æ–°æ•°æ®åº“**
   ```bash
   # æ·»åŠ æ–°å­—æ®µ
   npx wrangler d1 execute easytier-db --command="ALTER TABLE users ADD COLUMN is_super_admin INTEGER DEFAULT 0"
   
   # åˆ›å»ºç³»ç»Ÿè®¾ç½®è¡¨
   npx wrangler d1 execute easytier-db --command="CREATE TABLE IF NOT EXISTS system_settings (id INTEGER PRIMARY KEY AUTOINCREMENT, setting_key TEXT UNIQUE NOT NULL, setting_value TEXT NOT NULL, description TEXT, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP)"
   
   # æ’å…¥é»˜è®¤è®¾ç½®
   npx wrangler d1 execute easytier-db --file=./migration.sql
   ```

4. **æ ‡è®°ç°æœ‰ç®¡ç†å‘˜ä¸ºè¶…çº§ç®¡ç†å‘˜**
   ```bash
   npx wrangler d1 execute easytier-db --command="UPDATE users SET is_super_admin = 1 WHERE email = 'admin@example.com'"
   ```

5. **æ ‡è®°ç³»ç»Ÿå·²åˆå§‹åŒ–**
   ```bash
   npx wrangler d1 execute easytier-db --command="INSERT INTO system_settings (setting_key, setting_value) VALUES ('system_initialized', '1')"
   ```

6. **é‡æ–°éƒ¨ç½²**
   ```bash
   npm run deploy
   ```

---

## [1.0.0] - 2025-01-03

### ğŸ‰ é¦–æ¬¡å‘å¸ƒ

- âœ¨ ç”¨æˆ·æ³¨å†Œå’Œç™»å½•
- âœ¨ é‚®ç®±éªŒè¯ï¼ˆResendï¼‰
- âœ¨ èŠ‚ç‚¹ç®¡ç†ï¼ˆCRUDï¼‰
- âœ¨ èŠ‚ç‚¹ä¸ŠæŠ¥ API
- âœ¨ æ™ºèƒ½è´Ÿè½½å‡è¡¡æŸ¥è¯¢
- âœ¨ ç®¡ç†å‘˜é¢æ¿
- âœ¨ å“åº”å¼å‰ç«¯ç•Œé¢
- ğŸ“š å®Œæ•´çš„ API æ–‡æ¡£