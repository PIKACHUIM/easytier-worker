# ğŸ“š EasyTier èŠ‚ç‚¹ç®¡ç†ç³»ç»Ÿ - æ ¸å¿ƒæ–‡æ¡£

> æœ¬æ–‡æ¡£åŒ…å«ç³»ç»Ÿä½¿ç”¨ã€ç®¡ç†å’Œå¼€å‘çš„æ ¸å¿ƒä¿¡æ¯ã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1ï¸âƒ£ éƒ¨ç½²ç³»ç»Ÿ

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/yourusername/easytierwork.git
cd easytierwork
npm install

# åˆ›å»ºæ•°æ®åº“
npx wrangler d1 create easytier-db
# è®°å½•è¿”å›çš„ database_id

# é…ç½®ç¯å¢ƒï¼ˆç¼–è¾‘ wrangler.jsoncï¼‰
# å¡«å…¥ database_id å’Œç”Ÿæˆ JWT_SECRET

# åˆå§‹åŒ–æ•°æ®åº“
npx wrangler d1 execute easytier-db --file=./schema.sql

# éƒ¨ç½²åˆ° Cloudflare
npm run deploy
```

### 2ï¸âƒ£ ç³»ç»Ÿåˆå§‹åŒ–

1. è®¿é—® `https://your-domain.workers.dev/initialize`
2. è¾“å…¥ JWT å¯†é’¥ï¼ˆæ¥è‡ªé…ç½®æ–‡ä»¶ï¼‰
3. è®¾ç½®è¶…çº§ç®¡ç†å‘˜è´¦æˆ·
4. å®Œæˆåˆå§‹åŒ–

### 3ï¸âƒ£ å¼€å§‹ä½¿ç”¨

- **ç®¡ç†å‘˜**: ç™»å½•åå°ç®¡ç†ç³»ç»Ÿ
- **ç”¨æˆ·**: æ³¨å†Œè´¦æˆ·å¹¶æ·»åŠ èŠ‚ç‚¹
- **å¼€å‘è€…**: ä½¿ç”¨ API æ¥å…¥

---

## ğŸ‘¥ ç”¨æˆ·ç®¡ç†

### æƒé™ä½“ç³»

```
è¶…çº§ç®¡ç†å‘˜ â”€â”€â”¬â”€â”€ ç®¡ç†æ‰€æœ‰ç”¨æˆ·
            â”œâ”€â”€ ä¿®æ”¹ç³»ç»Ÿè®¾ç½®
            â””â”€â”€ æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹

æ™®é€šç®¡ç†å‘˜ â”€â”€â”¬â”€â”€ æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹
            â”œâ”€â”€ ä¿®æ”¹ç³»ç»Ÿè®¾ç½®
            â””â”€â”€ ç®¡ç†è‡ªå·±çš„èŠ‚ç‚¹

æ™®é€šç”¨æˆ· â”€â”€â”€â”€â”€â”´â”€â”€ ç®¡ç†è‡ªå·±çš„èŠ‚ç‚¹
```

### ç”¨æˆ·æ“ä½œ

| æ“ä½œ | è¶…çº§ç®¡ç†å‘˜ | æ™®é€šç®¡ç†å‘˜ | æ™®é€šç”¨æˆ· |
|------|------------|------------|----------|
| æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹ | âœ… | âœ… | âŒ |
| ä¿®æ”¹ç³»ç»Ÿè®¾ç½® | âœ… | âœ… | âŒ |
| ç®¡ç†ç”¨æˆ·æƒé™ | âœ… | âŒ | âŒ |
| åˆ é™¤ç”¨æˆ· | âœ… | âŒ | âŒ |
| ç®¡ç†è‡ªå·±çš„èŠ‚ç‚¹ | âœ… | âœ… | âœ… |

---

## ğŸ–¥ï¸ èŠ‚ç‚¹ç®¡ç†

### æ·»åŠ èŠ‚ç‚¹

```json
{
  "node_name": "åŒ—äº¬èŠ‚ç‚¹1",
  "region_type": "domestic",
  "region_detail": "åŒ—äº¬",
  "connections": [
    {"type": "TCP", "ip": "1.2.3.4", "port": 8080},
    {"type": "WS", "ip": "1.2.3.4", "port": 8081}
  ],
  "tier_bandwidth": 100,
  "max_bandwidth": 1000,
  "max_traffic": 1000,
  "reset_cycle": 30,
  "max_connections": 100,
  "allow_relay": true,
  "tags": "é«˜é€Ÿ,ç¨³å®š",
  "valid_until": "2025-12-31"
}
```

### èŠ‚ç‚¹çŠ¶æ€

- **åœ¨çº¿**: èŠ‚ç‚¹æ­£å¸¸å·¥ä½œ
- **ç¦»çº¿**: èŠ‚ç‚¹æœªä¸ŠæŠ¥æˆ–å¼‚å¸¸
- **è´Ÿè·**: 2-9çº§ï¼Œæ•°å­—è¶Šå¤§è´Ÿè½½è¶Šé«˜

---

## ğŸ”Œ API ä½¿ç”¨

### èŠ‚ç‚¹ä¸ŠæŠ¥

```bash
curl -X POST https://your-domain.workers.dev/api/report \
  -H "Content-Type: application/json" \
  -d '{
    "node_name": "beijing-node-1",
    "email": "user@example.com",
    "token": "your-report-token",
    "current_bandwidth": 50.5,
    "reported_traffic": 0.5,
    "connection_count": 5,
    "status": "online"
  }'
```

### æ™ºèƒ½æŸ¥è¯¢

```bash
# æµé‡ä¼˜å…ˆ
curl -X POST https://your-domain.workers.dev/api/query \
  -H "Content-Type: application/json" \
  -d '{"region": "domestic", "priority": "traffic"}'

# å¸¦å®½ä¼˜å…ˆ
curl -X POST https://your-domain.workers.dev/api/query \
  -H "Content-Type: application/json" \
  -d '{"priority": "bandwidth"}'

# å»¶è¿Ÿä¼˜å…ˆ
curl -X POST https://your-domain.workers.dev/api/query \
  -H "Content-Type: application/json" \
  -d '{"priority": "latency"}'
```

### è·å–ç»Ÿè®¡

```bash
curl https://your-domain.workers.dev/api/stats
```

---

## ğŸ”‘ Token ç®¡ç†

### è·å– Token

1. ç™»å½•ç³»ç»Ÿ
2. è¿›å…¥"æˆ‘çš„èŠ‚ç‚¹"
3. æŸ¥çœ‹èŠ‚ç‚¹å¡ç‰‡çš„"ä¸ŠæŠ¥Token"
4. å¤åˆ¶32ä½åå…­è¿›åˆ¶Token

### é‡æ–°ç”Ÿæˆ Token

1. åœ¨èŠ‚ç‚¹åˆ—è¡¨ä¸­æ‰¾åˆ°ç›®æ ‡èŠ‚ç‚¹
2. ç‚¹å‡»"é‡æ–°ç”ŸæˆToken"
3. å¤åˆ¶æ–°Tokenå¹¶æ›´æ–°ä¸ŠæŠ¥è„šæœ¬

âš ï¸ **æ³¨æ„**: é‡æ–°ç”Ÿæˆåæ—§Tokenç«‹å³å¤±æ•ˆï¼

---

## âš™ï¸ ç³»ç»Ÿé…ç½®

### é‚®ä»¶æœåŠ¡ (Resend)

```json
{
  "resend_api_key": "re_xxxxx",
  "resend_from_email": "noreply@yourdomain.com",
  "resend_from_domain": "yourdomain.com"
}
```

é…ç½®æ­¥éª¤ï¼š
1. æ³¨å†Œ [Resend](https://resend.com) è´¦æˆ·
2. åˆ›å»º API å¯†é’¥
3. æ·»åŠ å¹¶éªŒè¯åŸŸå
4. åœ¨ç³»ç»Ÿè®¾ç½®ä¸­å¡«å†™é…ç½®

### ç½‘ç«™è®¾ç½®

```json
{
  "site_name": "EasyTier èŠ‚ç‚¹ç®¡ç†ç³»ç»Ÿ",
  "site_url": "https://easytier.example.com"
}
```

---

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„

```
src/
â”œâ”€â”€ routes/          # API è·¯ç”±
â”‚   â”œâ”€â”€ auth.ts     # ç”¨æˆ·è®¤è¯
â”‚   â”œâ”€â”€ nodes.ts    # èŠ‚ç‚¹ç®¡ç†
â”‚   â”œâ”€â”€ api.ts      # å…¬å¼€ API
â”‚   â””â”€â”€ system.ts   # ç³»ç»Ÿç®¡ç†
â”œâ”€â”€ client/         # å‰ç«¯è„šæœ¬
â”œâ”€â”€ index.tsx       # åº”ç”¨å…¥å£
â”œâ”€â”€ types.ts        # ç±»å‹å®šä¹‰
â”œâ”€â”€ utils.ts        # å·¥å…·å‡½æ•°
â””â”€â”€ style.css       # æ ·å¼æ–‡ä»¶
```

### æœ¬åœ°å¼€å‘

```bash
npm run dev
# è®¿é—® http://localhost:8787
```

### æ·»åŠ æ–°åŠŸèƒ½

1. åœ¨ `src/routes/` åˆ›å»ºè·¯ç”±æ–‡ä»¶
2. åœ¨ `src/index.tsx` æ³¨å†Œè·¯ç”±
3. æ›´æ–°å‰ç«¯ç»„ä»¶å’Œæ ·å¼
4. æµ‹è¯•å¹¶æ›´æ–°æ–‡æ¡£

---

## ğŸ“Š è´Ÿè½½å‡è¡¡ç®—æ³•

### æµé‡ä¼˜å…ˆ
```
äººå‡æ—¥æµé‡ = (æœ€å¤§æµé‡ - å·²ç”¨æµé‡) / å‰©ä½™å¤©æ•° / å½“å‰è¿æ¥æ•°
```
ä¼˜å…ˆåˆ†é…äººå‡æ—¥æµé‡æœ€é«˜çš„èŠ‚ç‚¹

### å¸¦å®½ä¼˜å…ˆ
```
äººå‡å¸¦å®½ = å½“å‰é˜¶æ¢¯å¸¦å®½ / å½“å‰è¿æ¥æ•°
```
ä¼˜å…ˆåˆ†é…äººå‡å¸¦å®½æœ€é«˜çš„èŠ‚ç‚¹

### å»¶è¿Ÿä¼˜å…ˆ
è¿”å›è¿æ¥æ•°æœ€å°‘çš„èŠ‚ç‚¹ï¼ˆç®€åŒ–å®ç°ï¼Œå®é™…åº”åŸºäºåœ°ç†è·ç¦»ï¼‰

---

## ğŸ”’ å®‰å…¨æœ€ä½³å®è·µ

### å¿…é¡»é…ç½®
- âœ… ä½¿ç”¨å¼ºéšæœº JWT_SECRET
- âœ… å¯ç”¨ HTTPSï¼ˆCloudflare é»˜è®¤ï¼‰
- âœ… é…ç½®é‚®ä»¶éªŒè¯ï¼ˆå¯é€‰ä½†æ¨èï¼‰

### å»ºè®®æªæ–½
- ğŸ” å®šæœŸæ›´æ¢å¯†é’¥
- ğŸ” ä½¿ç”¨å¼ºå¯†ç 
- ğŸ” è°¨æ…æˆäºˆç®¡ç†å‘˜æƒé™
- ğŸ” å®šæœŸå¤‡ä»½æ•°æ®

### å®‰å…¨æ£€æŸ¥æ¸…å•
- [ ] JWT_SECRET è¶³å¤Ÿå¤æ‚ï¼ˆ32å­—ç¬¦ä»¥ä¸Šï¼‰
- [ ] è¶…çº§ç®¡ç†å‘˜ä½¿ç”¨å¼ºå¯†ç 
- [ ] Resend API å¯†é’¥å·²é…ç½®
- [ ] ç”¨æˆ·æƒé™åˆ†é…åˆç†
- [ ] å®šæœŸæŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—

---

## â“ å¸¸è§é—®é¢˜

### ç³»ç»Ÿåˆå§‹åŒ–

**Q: å¿˜è®° JWT å¯†é’¥æ€ä¹ˆåŠï¼Ÿ**
A: æŸ¥çœ‹ `wrangler.jsonc` ä¸­çš„ `JWT_SECRET` é…ç½®

**Q: å¯ä»¥é‡æ–°åˆå§‹åŒ–ç³»ç»Ÿå—ï¼Ÿ**
A: éœ€è¦æ‰‹åŠ¨åœ¨æ•°æ®åº“ä¸­é‡ç½®åˆå§‹åŒ–çŠ¶æ€ï¼Œä¸å»ºè®®é‡å¤åˆå§‹åŒ–

### èŠ‚ç‚¹ç®¡ç†

**Q: èŠ‚ç‚¹æ˜¾ç¤ºç¦»çº¿æ€ä¹ˆåŠï¼Ÿ**
A: æ£€æŸ¥ä¸ŠæŠ¥è„šæœ¬ã€Tokenæ˜¯å¦æ­£ç¡®ã€ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸

**Q: å¦‚ä½•æ‰¹é‡æ·»åŠ èŠ‚ç‚¹ï¼Ÿ**
A: å½“å‰ç‰ˆæœ¬ä»…æ”¯æŒå•ä¸ªæ·»åŠ ï¼Œå¯ä»¥é€šè¿‡ API æ‰¹é‡å¯¼å…¥

### API ä½¿ç”¨

**Q: æŸ¥è¯¢è¿”å›ç©ºç»“æœï¼Ÿ**
A: æ£€æŸ¥èŠ‚ç‚¹çŠ¶æ€ã€åœ°åŸŸç­›é€‰ã€æŸ¥è¯¢æ¡ä»¶æ˜¯å¦æ­£ç¡®

**Q: Token éªŒè¯å¤±è´¥ï¼Ÿ**
A: ç¡®è®¤èŠ‚ç‚¹åç§°ã€é‚®ç®±ã€Tokenä¸‰è€…åŒ¹é…

### é‚®ä»¶æœåŠ¡

**Q: é‚®ä»¶å‘é€å¤±è´¥ï¼Ÿ**
A: æ£€æŸ¥ Resend API å¯†é’¥ã€åŸŸåéªŒè¯ã€å‘é€é¢‘ç‡é™åˆ¶

---

## ğŸ“ˆ æ€§èƒ½ç›‘æ§

### å…³é”®æŒ‡æ ‡

| æŒ‡æ ‡ | ç›‘æ§æ–¹æ³• | æ­£å¸¸èŒƒå›´ |
|------|----------|----------|
| å“åº”æ—¶é—´ | `npx wrangler tail` | < 100ms |
| é”™è¯¯ç‡ | Cloudflare Dashboard | < 1% |
| æ•°æ®åº“æŸ¥è¯¢ | D1 Dashboard | < 50ms |
| å†…å­˜ä½¿ç”¨ | Workers Dashboard | < 128MB |

### ä¼˜åŒ–å»ºè®®

- ğŸš€ ä½¿ç”¨æ•°æ®åº“ç´¢å¼•
- ğŸš€ å¯ç”¨ Cloudflare ç¼“å­˜
- ğŸš€ å‡å°‘ API å“åº”å¤§å°
- ğŸš€ ä¼˜åŒ–æŸ¥è¯¢è¯­å¥

---

## ğŸ†˜ æ•…éšœæ’é™¤

### æ•°æ®åº“é—®é¢˜

```bash
# æ£€æŸ¥æ•°æ®åº“è¿æ¥
npx wrangler d1 list
npx wrangler d1 execute easytier-db --command="SELECT name FROM sqlite_master WHERE type='table'"

# å¤‡ä»½æ•°æ®åº“
npx wrangler d1 export easytier-db --output=backup.sql

# æ¢å¤æ•°æ®åº“
npx wrangler d1 execute easytier-db --file=backup.sql
```

### æ—¥å¿—æŸ¥çœ‹

```bash
# å®æ—¶æ—¥å¿—
npx wrangler tail

# æŒ‰æ¡ä»¶è¿‡æ»¤
npx wrangler tail --format=pretty
```

### å¸¸è§é”™è¯¯ä»£ç 

| é”™è¯¯ | åŸå›  | è§£å†³æ–¹æ³• |
|------|------|----------|
| 401 | æœªæˆæƒ | æ£€æŸ¥ JWT Token |
| 403 | æƒé™ä¸è¶³ | æ£€æŸ¥ç”¨æˆ·æƒé™ |
| 404 | èµ„æºä¸å­˜åœ¨ | æ£€æŸ¥ API è·¯å¾„ |
| 500 | æœåŠ¡å™¨é”™è¯¯ | æŸ¥çœ‹æ—¥å¿— |

---

## ğŸ“ è·å–å¸®åŠ©

### æ–‡æ¡£èµ„æº
- ğŸ“– [å®Œæ•´ README](../README.md)
- ğŸ”§ [API æ–‡æ¡£](API.md)
- ğŸ’» [ç¤ºä¾‹ä»£ç ](../examples/)

### ç¤¾åŒºæ”¯æŒ
- ğŸ› [GitHub Issues](https://github.com/yourusername/easytierwork/issues)
- ğŸ’¬ [GitHub Discussions](https://github.com/yourusername/easytierwork/discussions)
- ğŸ“§ é‚®ç®±: your-email@example.com

### è´¡çŒ®æŒ‡å—
- ğŸ´ Fork é¡¹ç›®
- ğŸŒ¿ åˆ›å»ºç‰¹æ€§åˆ†æ”¯
- ğŸ“ æäº¤æ›´æ”¹
- ğŸ”„ å‘èµ· Pull Request

---

## ğŸ“ ç‰ˆæœ¬ä¿¡æ¯

- **å½“å‰ç‰ˆæœ¬**: v2.0.0
- **æœ€åæ›´æ–°**: 2025-01-04
- **ç»´æŠ¤çŠ¶æ€**: ğŸŸ¢ æ´»è·ƒå¼€å‘
- **è®¸å¯è¯**: GPL-3.0

---

<div align="center">

**æ„Ÿè°¢ä½¿ç”¨ EasyTier èŠ‚ç‚¹ç®¡ç†ç³»ç»Ÿï¼**

å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·ç»™æˆ‘ä»¬ä¸€ä¸ª â­

Made with â¤ï¸ by EasyTier Team

</div>