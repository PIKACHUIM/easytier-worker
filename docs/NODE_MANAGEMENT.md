# 节点管理指南

本文档详细介绍如何在 EasyTier 节点管理系统中添加、编辑和管理节点。

## 目录

- [节点信息说明](#节点信息说明)
- [添加节点](#添加节点)
- [查看节点详情](#查看节点详情)
- [编辑节点](#编辑节点)
- [删除节点](#删除节点)
- [节点上报Token](#节点上报token)

## 节点信息说明

每个节点包含以下信息：

### 基本信息
- **节点名称**：节点的唯一标识名称
- **地域类型**：大陆或海外
- **具体地区**：节点所在的具体地理位置（如：北京、东京）
- **用户邮箱**：节点所有者的邮箱地址
- **创建时间**：节点创建的时间
- **有效期至**：节点的有效期截止时间
- **当前状态**：在线/离线
- **最后上报时间**：节点最后一次上报数据的时间
- **允许中转**：是否允许作为中转节点
- **标签**：节点的标签（可选）
- **备注信息**：节点的备注说明（可选）

### 连接方式
节点可以配置多个连接方式，每个连接包含：
- **协议类型**：TCP、UDP、WS、WSS、WG
- **IP地址**：连接的IP地址
- **端口**：连接的端口号

### 带宽信息
- **当前带宽**：节点当前使用的带宽（Mbps）
- **阶梯带宽**：当前阶梯的带宽限制（Mbps）
- **最大带宽**：服务器的最大带宽（Mbps）

### 流量信息
- **已用流量**：节点已使用的总流量（GB）
- **修正流量**：管理员手动修正的流量（GB）
- **上报流量**：节点实际上报的流量 = 已用流量 - 修正流量（GB）
- **最大流量**：流量配额上限（GB）
- **重置周期**：流量重置的周期（天）
- **下次重置时间**：下一次流量重置的时间

### 连接信息
- **当前连接数**：当前活跃的连接数量
- **最大连接数**：允许的最大连接数

### 状态信息
- **近期状态**：30天内每10分钟的负荷情况
  - 0：未知
  - 1：离线
  - 2-9：不同负荷等级

### 上报Token
- **report_token**：用于节点上报数据的验证令牌

## 添加节点

### 步骤

1. 登录系统后，进入"我的节点"页面
2. 点击页面顶部的"添加节点"按钮
3. 填写节点信息：

#### 必填字段
- **节点名称**：输入节点的名称（如：北京节点1）
- **地域类型**：选择"大陆"或"海外"
- **具体地区**：输入具体地区（如：北京、东京）
- **连接方式**：至少添加一个连接方式
  - 选择协议类型（TCP/UDP/WS/WSS/WG）
  - 输入IP地址
  - 输入端口号
  - 可点击"+ 添加连接"按钮添加多个连接方式
- **阶梯带宽**：输入当前阶梯带宽（Mbps）
- **最大带宽**：输入服务器最大带宽（Mbps）
- **最大流量**：输入流量配额（GB）
- **重置周期**：输入流量重置周期（天）
- **最大连接数**：输入允许的最大连接数
- **有效期至**：选择节点的有效期截止日期

#### 可选字段
- **允许中转**：勾选此项表示允许节点作为中转
- **标签**：输入节点标签（如：高速、稳定）
- **备注信息**：输入节点的其他说明信息

4. 点击"保存节点"按钮完成添加

### 示例

```
节点名称：北京高速节点
地域类型：大陆
具体地区：北京
连接方式：
  - TCP - 192.168.1.100:8080
  - UDP - 192.168.1.100:8081
阶梯带宽：100 Mbps
最大带宽：1000 Mbps
最大流量：1000 GB
重置周期：30 天
最大连接数：100
有效期至：2025-12-31
允许中转：是
标签：高速、稳定
备注：主要用于测试环境
```

## 查看节点详情

### 步骤

1. 在"我的节点"页面，找到要查看的节点
2. 点击节点卡片上的"查看详情"按钮
3. 在弹出的详情窗口中可以看到：
   - 基本信息
   - 所有连接方式
   - 带宽与流量详细信息
   - 连接信息
   - 上报Token

### 详情页面功能

- **复制Token**：点击"复制Token"按钮可以将上报Token复制到剪贴板
- **重新生成Token**：点击"重新生成Token"按钮可以生成新的Token（旧Token将失效）

## 编辑节点

### 可编辑字段

用户可以编辑以下节点信息：
- 节点名称
- 地域类型和具体地区
- 连接方式（添加、删除、修改）
- 阶梯带宽
- 最大带宽
- 最大流量
- 重置周期
- 最大连接数
- 有效期
- 允许中转
- 标签
- 备注信息

### 步骤

1. 在"我的节点"页面，找到要编辑的节点
2. 点击节点卡片上的"编辑"按钮
3. 在弹出的编辑窗口中修改需要更改的信息
4. 点击"保存节点"按钮完成修改

### 注意事项

- 修改连接方式时，可以点击"删除"按钮删除不需要的连接
- 可以点击"+ 添加连接"按钮添加新的连接方式
- 修改重置周期会重新计算下次重置时间
- 某些字段（如已用流量、当前带宽等）由系统自动更新，无法手动编辑

## 删除节点

### 步骤

1. 在"我的节点"页面，找到要删除的节点
2. 点击节点卡片上的"删除"按钮
3. 在确认对话框中点击"确定"

### 注意事项

⚠️ **删除操作不可恢复**，删除节点后：
- 节点的所有数据将被永久删除
- 节点的上报Token将失效
- 无法恢复节点的历史数据

## 节点上报Token

### Token说明

每个节点都有一个唯一的上报Token，用于节点向服务器上报数据时的身份验证。

### Token格式

Token是一个32位的十六进制字符串，例如：
```
a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6
```

### 获取Token

1. 在"我的节点"页面，点击节点的"查看详情"按钮
2. 在详情页面的"上报Token"部分可以看到Token
3. 点击"复制Token"按钮将Token复制到剪贴板

### 重新生成Token

如果Token泄露或需要更换，可以重新生成：

1. 在节点详情页面，点击"重新生成Token"按钮
2. 确认操作后，系统会生成新的Token
3. **旧Token将立即失效**

### 使用Token上报数据

节点上报数据时需要提供以下信息：
- 节点名称
- 用户邮箱
- 上报Token
- 当前带宽
- 本次上报的流量增量
- 当前连接数
- 节点状态（在线/离线）

API端点：`POST /api/report`

请求示例：
```json
{
  "node_name": "北京高速节点",
  "email": "user@example.com",
  "token": "a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6",
  "current_bandwidth": 50.5,
  "reported_traffic": 10.2,
  "connection_count": 25,
  "status": "online"
}
```

### Token安全建议

- 不要在公开场合分享Token
- 定期更换Token以提高安全性
- 如果怀疑Token泄露，立即重新生成
- 妥善保管Token，避免被他人获取

## 管理员功能

管理员可以查看所有用户的节点，并具有以下额外权限：

### 查看所有节点

在"管理员面板"页面可以查看系统中所有节点的详细信息，包括：
- 节点所有者
- 所有节点信息
- 节点状态和统计数据

### 修正流量

管理员可以修改节点的修正流量字段，用于调整节点的实际流量统计。

## 常见问题

### 1. 为什么我的节点显示离线？

可能的原因：
- 节点未正常上报数据
- 上报Token错误
- 节点服务未运行
- 网络连接问题

### 2. 如何增加节点的流量配额？

编辑节点，修改"最大流量"字段即可。

### 3. 节点的流量什么时候重置？

根据节点的"重置周期"设置，系统会在到达重置日期时自动重置流量。

### 4. 可以添加多少个连接方式？

理论上没有限制，但建议根据实际需要添加，通常2-3个连接方式即可。

### 5. 修正流量是什么？

修正流量是管理员用于调整节点流量统计的字段。实际已用流量 = 上报流量 + 修正流量。

## 参考链接

- [API文档](./API.md)
- [管理员指南](./ADMIN_GUIDE.md)
- [Token使用指南](./TOKEN_GUIDE.md)
- [常见问题](./FAQ.md)
